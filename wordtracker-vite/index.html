<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NaNo Word Tracker</title>
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Literata:wght@700;800&display=swap" rel="stylesheet">

</head>
<body>
<div class="wrap">

  <!-- Header -->
  <div class="headerbar">
    <div class="header-left">
      <div class="title-row">
        <h1 class="h1" id="projectTitle">NaNo 2025</h1>
        <button id="editProjectBtn" class="icon-btn" aria-label="Edit project settings" title="Edit project">‚úèÔ∏è</button>
      </div>
      <div class="header-meta">
        <span class="badge" id="viewBadge" style="cursor:pointer" title="Click to preview another day">Date: ‚Äî</span>
      </div>
    </div>
    <div class="header-right">
      <span id="syncStatus" class="sync-chip" aria-live="polite">Local mode</span>
      <button id="moreBtn" class="icon-btn" aria-label="More actions" title="More actions" aria-expanded="false" aria-controls="actionsMenu">‚ãØ</button>
      <button id="authBtn" class="btn btn-primary">Sign in</button>
      <span id="accountChip" class="badge" style="display:none;cursor:pointer" title="View account">
  üîê <span id="accountEmail"></span>
</span>
    </div>
  </div>

  <div id="actionsMenu" class="dropdown" role="menu" aria-hidden="true">
    <section>
      <h4>Sync &amp; account</h4>
      <div class="actions-row">
        <button id="refreshBtn" class="btn btn-quiet" role="menuitem">Sync now</button>
        <span id="drawerSyncStatus" class="sync-chip" aria-live="polite">Local mode</span>
      </div>
    </section>
    <section>
      <h4>Data</h4>
      <p class="action-note">Export downloads a JSON backup. Import restores a previous export.</p>
      <div class="actions-row">
        <button id="exportBtn" class="btn" role="menuitem">Export</button>
        <button id="importBtn" class="btn" role="menuitem">Import</button>
        <input id="importInput" type="file" accept="application/json" style="display:none">
      </div>
    </section>
    <section>
      <h4>Customize</h4>
      <button id="openSettings" class="btn btn-quiet" role="menuitem">Project &amp; theme‚Ä¶</button>
    </section>
    <section>
      <h4>Entries</h4>
      <button id="editEntriesBtn" class="btn btn-quiet" role="menuitem">Edit entries‚Ä¶</button>
    </section>
  </div>

  <!-- Auth prompt -->
  <div id="authbar" class="authbar" style="display:none">
    <span>üîí Sign in to protect your progress across devices.</span>
    <button id="authBarBtn" class="btn btn-primary">Sign in</button>
  </div>

  <!-- Motivation banner -->
  <div class="motivation" id="motivationBanner" role="status" aria-live="polite"></div>

  <!-- Quick add -->
  <div class="card add-card">
    <div class="add-fields">
      <label for="addWords">Words just written</label>
      <input id="addWords" type="number" inputmode="numeric" placeholder="e.g., 347" min="0">
    </div>
    <div class="add-actions">
      <button id="addBtn" class="btn btn-primary">Add to today</button>
      <button id="undoBtn" class="btn btn-quiet">Undo</button>
    </div>
  </div>

  <!-- Insights -->
  <div class="insights">
    <div class="card stats-card" aria-live="polite">
      <div class="stats">
        <div class="stat" id="todayStat">
          <div class="k">Words today</div>
          <div class="v" id="todayWords">0</div>
          <div class="sub" id="todayGoalHint"></div>
        </div>
        <div class="stat">
          <div class="k">Needed / day</div>
          <div class="v" id="needed">0</div>
          <div class="sub" id="neededHint"></div>
        </div>
        <div class="stat">
          <div class="k">Remaining</div>
          <div class="v" id="remaining">0</div>
          <div class="sub" id="remainingHint"></div>
        </div>
        <div class="stat">
          <div class="k">Total words</div>
          <div class="v" id="total">0</div>
          <div class="sub" id="totalHint"></div>
        </div>
        <div class="stat stat-progress">
          <div class="k">Progress</div>
          <div class="v" id="pct">0%</div>
          <div class="progress"><div id="bar" class="bar"></div></div>
        </div>
      </div>
    </div>

    <div class="card chart-card">
      <div class="chartwrap">
        <svg id="chart" class="chart" viewBox="0 0 900 400" preserveAspectRatio="none" aria-label="Progress chart"></svg>
        <div id="tooltip" class="tooltip" role="tooltip" aria-hidden="true"></div>
        <div class="legend"><span class="kdot" style="background:var(--leaf)"></span> Cumulative <span class="kline"></span> Pace</div>
      </div>
    </div>
  </div>

  <!-- Settings overlay -->
  <div id="settings" class="overlay" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
    <div class="panel" data-panel tabindex="-1">
      <div class="sticky row" style="justify-content:space-between">
        <h3 id="settingsTitle" style="margin:0">Project Settings</h3>
        <button id="closeSettings" class="btn">Close</button>
      </div>
      <div class="card" style="margin-top:12px">
        <div class="row" style="gap:12px;flex-wrap:wrap">
          <div style="flex:1 1 260px"><label>Project name</label><input id="name" type="text" value="NaNo 2025"></div>
          <div style="flex:1 1 160px"><label>Goal words</label><input id="goal" type="number" min="1" value="50000"></div>
          <div style="flex:1 1 160px"><label>Start date</label><input id="start" type="date"></div>
          <div style="flex:1 1 160px"><label>End date</label><input id="end" type="date"></div>
          <div style="flex:1 1 200px"><label>Starting words</label><input id="startingWords" type="number" min="0" value="0"></div>
          <div style="flex:1 1 200px"><label>Theme</label><select id="themeSelect" class="select-input"></select></div>
        </div>
      </div>
      <div class="footer-sticky row" style="justify-content:space-between;gap:8px;margin-top:12px">
        <button id="resetAllBtn" class="btn btn-danger">Reset all data</button>
        <div class="actions">
          <button id="saveSettings" class="btn btn-primary">Save</button>
          <button id="closeSettings2" class="btn btn-quiet">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Time Warp popover -->
  <div id="warpPopover" class="popover" role="dialog" aria-labelledby="warpTitle" aria-modal="false" aria-hidden="true">
    <div class="popover-card">
      <h3 id="warpTitle">Current date</h3>
      <p id="currentDateInfo" class="muted"></p>
      <label class="toggle-row">
        <input id="warpToggle" type="checkbox" aria-label="Enable preview mode">
        Preview another day
      </label>
      <label class="field">
        <span>Preview date</span>
        <input id="warpDate" type="date" aria-describedby="warpHelp">
      </label>
      <p id="warpHelp" class="muted">When preview mode is on, totals and pacing update as if it were that date. Adding words targets the previewed day.</p>
    </div>
  </div>

  <!-- Entries overlay -->
  <div id="drawer" class="overlay" role="dialog" aria-modal="true" aria-labelledby="entriesTitle">
    <div class="panel" data-panel tabindex="-1">
      <div class="sticky row" style="justify-content:space-between;align-items:center">
        <h3 id="entriesTitle" style="margin:0">Daily entries</h3>
        <div class="jump">
          <label for="jumpDate" class="k">Jump to</label>
          <select id="jumpDate" class="btn-quiet" style="padding:8px 10px;border-radius:8px;border:1px solid var(--border)"></select>
        </div>
        <button id="closeEntries" class="btn">Close</button>
      </div>
      <div id="entries" class="entries" style="margin-top:10px"></div>
      <div class="footer-sticky row" style="justify-content:flex-end;gap:8px;margin-top:12px">
        <button id="closeEntries2" class="btn btn-primary">Done</button>
      </div>
    </div>
  </div>

  <!-- Login overlay (magic link) -->
  <div id="login" class="overlay" data-align="center" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
    <div class="panel" data-panel tabindex="-1">
      <div class="sticky row" style="justify-content:space-between">
        <h3 id="loginTitle" style="margin:0">Sign in to sync</h3>
      <button id="closeLogin" class="btn">Close</button>
      </div>
      <div class="card" style="margin-top:12px">
        <div id="signInPane">
          <label for="email">Email for magic link</label>
          <input id="email" type="email" placeholder="you@example.com" autocomplete="email">
          <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
            <button id="sendLink" class="btn btn-primary">Send magic link</button>
            <button id="resendLink" class="btn btn-quiet" style="display:none">Resend</button>
          </div>
          <p id="loginStatus" style="font-size:13px;color:var(--muted);margin-top:10px"></p>
        </div>
        <div id="signedInPane" style="display:none">
          <div id="acctInfo" style="font-size:13px;color:var(--muted);margin-bottom:12px">
            Signed in as <strong id="acctEmail"></strong>
          </div>
          <p style="font-size:13px;color:var(--muted);margin:0 0 12px 0">Cloud sync is active on this device. Sign out to switch accounts.</p>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button id="signOut" class="btn btn-quiet">Sign out</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

</div>

<!-- Supabase client (public) -->
<script type="module" src="/src/main.js"></script>
</body>
</html>
